<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduGate | Resit Exam Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="main-bg">

  <header class="d-flex justify-content-between align-items-center px-4 py-3 shadow bg-white">
    <a href="faculty_secretary_home.html" class="d-flex align-items-center text-decoration-none text-dark">
      <img src="logo.png" alt="EduGate Logo" style="width: 50px;" />
      <span class="ms-2 fw-bold fs-5">EduGate</span>
    </a>
    <h4 class="m-0 text-center flex-grow-1 fw-bold">
      <i class="fa-solid fa-house bg-info p-2 rounded-circle text-white me-2"></i>
      <span>Resit <span class="text-primary">Exam Details</span></span>
    </h4>
    <div class="d-flex gap-2">
      <button onclick="logout()" class="btn btn-outline-danger rounded-pill">
        <i class="fa-solid fa-arrow-right-from-bracket me-1"></i> Logout
      </button>
    </div>
  </header>

  <main class="page-bg d-flex justify-content-center align-items-center flex-column py-5">
    <div id="formBox" class="form-box-hidden">
      <h5 class="fw-bold mb-4">Resit Exam Details</h5>
      <form class="d-flex flex-column gap-3">
        <div>
          <label class="form-label">Course Code</label>
          <select id="courseSelect" class="form-select">
            <option value="">Select Course</option>
            <option value="ST102">ST102</option>
            <option value="DB202">DB202</option>
            <option value="EN101">EN101</option>
            <option value="MATH101">MATH101</option>
            <option value="MATH012">MATH012</option>
            <option value="HS205">HS205</option>
            <option value="PSY210">PSY210</option>
          </select>
        </div>
        <div>
          <label class="form-label">Exam Time <small class="text-muted">(Set by Faculty Secretary)</small></label>
          <div class="d-flex">
            <input id="examHour" type="number" min="1" max="12" class="form-control fw-bold" placeholder="Hour" required />
            <input id="examMinute" type="number" min="0" max="59" class="form-control fw-bold" placeholder="Minute" required />
            <select id="examPeriod" class="form-select fw-bold" required>
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </select>
          </div>
        </div>
        <div>
          <label class="form-label">Room <small class="text-muted">(Set by Faculty Secretary)</small></label>
          <input id="examRoom" type="text" class="form-control fw-bold" placeholder="e.g., Room A101" required oninput="capitalizeFirstLetter()" />
        </div>
        <button type="button" class="btn btn-dark fw-bold mt-3 rounded-pill" onclick="addExam()">Update</button>
      </form>
    </div>

    <div class="resit-box p-4 rounded-4 shadow">
      <h5 class="fw-bold mb-3">Resit Courses</h5>
      <div id="examList" class="d-flex flex-column gap-3"></div>
      <div class="text-center mt-3 d-flex justify-content-center gap-2">
        <button class="btn btn-primary rounded-pill" onclick="showFormBox()">Add</button>
        <button class="btn btn-danger rounded-pill" onclick="enableEditMode()">Edit</button>
      </div>
    </div>
  </main>
  <script src="init.js"></script>

  <script>
    
    function logout() {
      localStorage.clear();
      window.location.href = "index.html";
    }

    // Function to ensure first letter of room is capitalized
    function capitalizeFirstLetter() {
      const roomInput = document.getElementById("examRoom");
      roomInput.value = roomInput.value.charAt(0).toUpperCase() + roomInput.value.slice(1);
    }

    function convertArabicNumbersToEnglish(str) {
      const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
      const englishNumbers = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
      return str.replace(/[٠١٢٣٤٥٦٧٨٩]/g, match => englishNumbers[arabicNumbers.indexOf(match)]);
    }

    function addExam() {
  const course = document.getElementById("courseSelect").value;
  let hour = document.getElementById("examHour").value;
  let minute = document.getElementById("examMinute").value;
  const period = document.getElementById("examPeriod").value;
  const room = document.getElementById("examRoom").value;

  if (!course || !hour || !minute || !period || !room) {
    return alert("All fields are required!");
  }

  // Convert Arabic numbers to English
  hour = convertArabicNumbersToEnglish(hour);
  minute = convertArabicNumbersToEnglish(minute);

  // Construct the time in HH:MM AM/PM format
  const examTime = `${hour}:${minute} ${period}`;

  // Display the data inside the page without saving it
  const examDetailsContainer = document.getElementById("examList");
  const box = document.createElement("div");
  box.className = "bg-white rounded p-3 d-flex justify-content-between align-items-center";
  box.innerHTML = `
    <div>
      <b>${course}</b> — Room: ${room} — Time: ${examTime}<br/>
    </div>
    <button class="btn btn-danger" onclick="deleteExam('${course}')">
      <i class="fa-solid fa-trash"></i>
    </button>
  `;
  examDetailsContainer.appendChild(box);

  // Hide the form box after adding the data
  document.getElementById("formBox").style.display = "none";

  // Save exam data in localStorage
  saveExamData(course, examTime, room);
}

// Save exam data function
function saveExamData(course, examTime, room) {
  let exams = JSON.parse(localStorage.getItem("examDetails")) || {};
  exams[course] = { examTime, room };
  localStorage.setItem("examDetails", JSON.stringify(exams));
}
    function showFormBox() {
      document.getElementById("formBox").style.display = "block";
      localStorage.setItem("formBoxVisible", "true");
    }

    function enableEditMode() {
      const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
      const container = document.getElementById("examList");
      container.innerHTML = "";

      Object.keys(exams).forEach(course => {
        const room = exams[course].room || "N/A";
        const time = exams[course].examTime || "N/A";
        const box = document.createElement("div");
        box.className = "bg-white rounded p-3 d-flex justify-content-between align-items-center";
        box.innerHTML = `
          <div>
            <b>${course}</b> — Room: ${room} — Time: ${time}<br/>
          </div>
          <button class="btn btn-danger" onclick="deleteExam('${course}')">
            <i class="fa-solid fa-trash"></i>
          </button>
        `;
        container.appendChild(box);
      });
    }

    function deleteExam(courseCode) {
      const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
      if (confirm(`Are you sure you want to delete ${courseCode}?`)) {
        delete exams[courseCode];
        localStorage.setItem("examDetails", JSON.stringify(exams));
        enableEditMode();
      }
    }

    function saveExamData(course, examTime, room) {
  let exams = JSON.parse(localStorage.getItem("examDetails")) || {};
  exams[course] = { examTime, room };
  localStorage.setItem("examDetails", JSON.stringify(exams));
}

    document.addEventListener("DOMContentLoaded", () => {
      enableEditMode();
      const formBoxVisible = localStorage.getItem("formBoxVisible");
      if (formBoxVisible === "true") {
        document.getElementById("formBox").style.display = "block";
      } else {
        document.getElementById("formBox").style.display = "none";
      }
    });
  </script>

</body>
</html>