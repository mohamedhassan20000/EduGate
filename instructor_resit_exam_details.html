<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduGate | Resit Exam Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body class="main-bg">
  <header class="d-flex justify-content-between align-items-center px-4 py-3 shadow bg-white">
    <a href="instructor_home.html" class="d-flex align-items-center text-decoration-none text-dark">
      <img src="logo.png" alt="EduGate Logo" style="width: 50px;" />
      <span class="ms-2 fw-bold fs-5">EduGate</span>
    </a>
    <h4 class="m-0 text-center flex-grow-1 fw-bold">
      <i class="fa-solid fa-house bg-info p-2 rounded-circle text-white me-2"></i>
      <span>Resit <span class="text-primary">Exam Details</span></span>
    </h4>
    <div class="d-flex gap-2">
      <a href="instructor_profile.html" class="btn btn-primary rounded-pill">
        <i class="fa-solid fa-user me-1"></i> My Profile
      </a>
      <button onclick="logout()" class="btn btn-outline-danger rounded-pill">
        <i class="fa-solid fa-arrow-right-from-bracket me-1"></i> Logout
      </button>
    </div>
  </header>

  <main class="page-bg d-flex justify-content-center align-items-center flex-column py-5">
    <div id="formBox" class="form-box-hidden">
        <h5 class="fw-bold mb-4">Resit Exam Details</h5>
      <form class="d-flex flex-column gap-3">
        <div>
          <label class="form-label">Course Code</label>
          <select id="courseSelect" class="form-select">
            <option value="">Select Course</option>
            <option value="ST102">ST102</option>
            <option value="DB202">DB202</option>
            <option value="EN101">EN101</option>
            <option value="MATH101">MATH101</option>
            <option value="MATH012">MATH012</option>
            <option value="HS205">HS205</option>
            <option value="PSY210">PSY210</option>
          </select>
        </div>
        <div>
          <label class="form-label">Exam Time <small class="text-muted">(Set by Faculty Secretary)</small></label>
          <input id="examTime" type="text" class="form-control fw-bold" placeholder="e.g., 2:00 pm" disabled />
        </div>
        <div>
          <label class="form-label">Room <small class="text-muted">(Set by Faculty Secretary)</small></label>
          <input id="examRoom" type="text" class="form-control fw-bold" placeholder="e.g., Room A101" disabled />
        </div>
        <div>
          <label class="form-label">Exam Details</label>
          <textarea id="examDescription" class="form-control" placeholder="Enter details here..." rows="3"></textarea>
        </div>
        <button type="button" class="btn btn-dark fw-bold mt-3 rounded-pill" onclick="addExam()">Update</button>
      </form>
    </div>

    <div class="resit-box p-4 rounded-4 shadow">
        <h5 class="fw-bold mb-3">Your Resit Courses</h5>
      <div id="examList" class="d-flex flex-column gap-3"></div>
      <div class="text-center mt-3 d-flex justify-content-center gap-2">
        <button class="btn btn-primary rounded-pill" onclick="showFormBox()">Add</button>
        <button class="btn btn-danger rounded-pill" onclick="enableEditMode()">Edit</button>
      </div>
    </div>
  </main>

  <script src="init.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- ✅ توست للنجاح -->
<div id="successToast" class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 9999; margin-top: 20px; display: none;">
  <div class="toast align-items-center text-bg-success border-0 show" role="alert">
    <div class="d-flex">
      <div class="toast-body fw-bold">✔️ Action completed successfully!</div>
    </div>
  </div>
</div>

<script>
  // حماية الصفحة - تأكيد أن اليوزر Instructor فقط
  const userType = localStorage.getItem("userType");
  if (userType !== "instructor") {
    window.location.href = "index.html"; 
  }

  function logout() {
    localStorage.clear();
    window.location.href = "index.html";
  }

  function addExam() {
    const course = document.getElementById("courseSelect").value;
    const description = document.getElementById("examDescription").value.trim();
    if (!course || !description) return alert("Course and details are required");

    const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
    if (!exams[course]) exams[course] = {};

    exams[course].description = description;
    exams[course].room = exams[course].room || "N/A";
    exams[course].time = exams[course].time || "N/A";
    localStorage.setItem("examDetails", JSON.stringify(exams));

    renderExams();

    // ✅ تنظيف الفورم بعد الإضافة
    document.getElementById("courseSelect").value = "";
    document.getElementById("examDescription").value = "";
    document.getElementById("examTime").value = "";
    document.getElementById("examRoom").value = "";

    // ✅ عرض Toast بعد التحديث
    showToast("✔️ Exam details updated successfully!");
  }

  function updateExamDetails() {
    const course = document.getElementById("courseSelect").value;
    const exams = JSON.parse(localStorage.getItem("examDetails")) || {};

    if (exams[course]) {
      document.getElementById("examRoom").value = exams[course].room || "N/A";
      document.getElementById("examTime").value = exams[course].time || "N/A";
    } else {
      document.getElementById("examRoom").value = "";
      document.getElementById("examTime").value = "";
    }
  }

  document.getElementById("courseSelect").addEventListener("change", updateExamDetails);

  function showFormBox() {
    document.getElementById("formBox").style.display = "block";
  }

  function enableEditMode() {
    const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
    const container = document.getElementById("examList");
    container.innerHTML = "";

    Object.keys(exams).forEach(course => {
      const detail = exams[course].description || "-";
      const room = exams[course].room || "N/A";
      const time = exams[course].time || "N/A";
      const box = document.createElement("div");
      box.className = "bg-white rounded p-3 d-flex justify-content-between align-items-center";
      box.innerHTML = `
        <div>
          <b>${course}</b> — Room: ${room} — Time: ${time}<br/>
          <p class="mt-2">${detail}</p>
        </div>
        <button class="btn btn-danger" onclick="deleteExam('${course}')">
          <i class="fa-solid fa-trash"></i>
        </button>
      `;
      container.appendChild(box);
    });
  }

  function deleteExam(courseCode) {
    const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
    if (confirm(`Are you sure you want to delete ${courseCode}?`)) {
      delete exams[courseCode];
      localStorage.setItem("examDetails", JSON.stringify(exams));
      enableEditMode();
      // ✅ عرض Toast بعد الحذف
      showToast(`❌ ${courseCode} deleted successfully!`);
    }
  }

  function renderExams() {
    const exams = JSON.parse(localStorage.getItem("examDetails")) || {};
    const container = document.getElementById("examList");
    container.innerHTML = "";

    Object.keys(exams).forEach(course => {
      const detail = exams[course].description || "-";
      const room = exams[course].room || "N/A";
      const time = exams[course].time || "N/A";
      const box = document.createElement("div");
      box.className = "bg-white rounded p-3";
      box.innerHTML = `
        <b>${course}</b> — Room: ${room} — Time: ${time}<br/>
        <p class="mt-2">${detail}</p>
      `;
      container.appendChild(box);
    });
  }

  function showToast(message) {
    const toastDiv = document.getElementById('successToast');
    toastDiv.querySelector('.toast-body').textContent = message;
    toastDiv.style.display = 'block';
    setTimeout(() => {
      toastDiv.style.display = 'none';
    }, 2500);
  }

  document.addEventListener("DOMContentLoaded", renderExams);
</script>

</body>
</html>
